name: Automatisation des tests DevSecOps

on: push

jobs:
  Dependances:
    runs-on: ubuntu-latest
    steps:
      - name: RÃ©cupÃ©ration du code
        uses: actions/checkout@v4

      - name: Installation de Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ContrÃ´le du fichier requirements.txt
        run: |
          if [ -f requirements.txt ]; then
            echo "âœ… Le fichier requirements.txt existe."
            pip install --upgrade pip
            pip install -r requirements.txt
            echo "âœ… Les dÃ©pendances ont Ã©tÃ© installÃ©es avec succÃ¨s."
          else
            echo "âŒ Le fichier requirements.txt est manquant."
            exit 1
          fi

      - name: Analyse de sÃ©curitÃ© des dÃ©pendances (optionnel)
        run: |
          pip install safety
          echo "ğŸ” Analyse des dÃ©pendances..."
          safety check -r requirements.txt || true

  Dockerfile:
    runs-on: ubuntu-latest
    needs: Dependances
    steps:
      - name: RÃ©cupÃ©ration du code
        uses: actions/checkout@v4

      - name: ContrÃ´le du Dockerfile
        run: |
          if [ -f Dockerfile ]; then
            echo "âœ… Le fichier Dockerfile existe."
            docker build -t breakableflask-test .
            echo "âœ… Le Dockerfile est valide et l'image s'est construite avec succÃ¨s."
          else
            echo "âŒ Le fichier Dockerfile est manquant."
            exit 1
          fi

  Deploy:
    runs-on: ubuntu-latest
    needs: Dockerfile
    steps:
      - name: Deploy
        run: |
          echo "ğŸš€ Rien Ã  faire ici. Votre application est prÃªte Ã  Ãªtre dÃ©ployÃ©e."
